<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Aaron PESCASIO - Mémoire</title>
  <meta name="generator" content="VuePress 1.8.3">
  <link rel="apple-touch-icon" size="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" size="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" size="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" size="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" size="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" size="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" size="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" size="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" size="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" size="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" size="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" size="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" size="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <link rel="stylesheet" href="/memo/memo_files/style.css">
  <link rel="stylesheet" href="/memo/memo_files/lang.css">
  <link rel="shortcut icon" href="/memo/memo_files/logo.png" type="image/x-icon">
  <meta name="description" content="Aaron PESCASIO - Mémoire">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="google-site-verification" content="4nm40QLVcDJmEJSAbrMfZ7fpBJZIXL1oSngBAYrZopY">

  <link rel="preload" href="/memo/memo_files/style.css" as="style">

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<meta name="description" content="Aaron Pescasio - Mémoire">
<meta property="og:title" content="Aaron Pescasio">
<meta property="og:description" content="Mémoire Administrateur">
<meta property="og:image" content="https://www.apescasio.fr/memo/memo_files/logo.png">
<meta property="og:url" content="https://www.apescasio.fr/memo">
</head> 

<style>
  :root {
    --darkreader-neutral-background: #0e1011;
    --darkreader-neutral-text: #dcd8d3;
    --darkreader-selection-background: #004aac;
    --darkreader-selection-text: #edebe8;
  }

  a.sidebar-link {
    color: rgb(176, 197, 215);
  }


  * {
    scrollbar-color: #42474a #1b1e1f;
  }

  .navbar {
    background-color: rgb(19, 21, 22);
    border-bottom-color: rgb(49, 55, 57);
  }

  .sidebar {
    background-color: rgb(19, 21, 22);
    border-right-color: rgb(49, 55, 57);
  }

  .search-box input {
    color: rgb(137, 168, 193);
    border-color: rgb(57, 62, 64);
    outline-color: currentcolor;
    background-color: rgb(19, 21, 22);
    background-image: url("https://www.apescasio.fr/memo/memo_files/search-icon.svg");
  }


  .navbar .site-name {
    color: rgb(176, 197, 215);
  }

  pre {
    background-color: rgb(18, 19, 20);
    color: rgb(209, 204, 197);
    border-color: rgb(110, 102, 89);
  }

  a,
  p a code {
    color: #9066b8;
  }

  *,
  *:before,
  *:after {
    box-sizing: border-box;
  }

  body {
    color: rgb(176, 197, 215);
  }

  .search-result-text-color {
    background-color: #44484a;
    color: rgb(176, 197, 215);
  }


  @media screen and (max-width: 719px) {
    .logo {
      margin-top: -10px;
    }

    .page-navigation {
      flex-wrap: wrap;
    }

    .page-navigation {
      flex-wrap: wrap;
    }

    .prevpage,
    .nextpage {
      flex: 1;
      text-align: center;
      margin: 0;
    }

    .prevpage {
      order: 1;
    }

    .nextpage {
      order: 2;
    }
  }
</style>

<body>



  <!--navbar-->
  <div class="theme-container">
    <header class="navbar">
      <div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img"
          viewBox="0 0 448 512" class="icon">
          <path fill="currentColor"
            d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z">
          </path>
        </svg></div> <a href="https://apescasio.fr/" aria-current="page"
        class="home-link router-link-exact-active router-link-active"><img src="/memo/memo_files/logo.png" alt="AP"
          class="logo"></a> <a href="https://apescasio.fr/memo"><span class="site-name can-hide">Mémoire</span></a>
      <div class="links">
        <div class="search-box"><input type="text" id="search-input" aria-label="Search" autocomplete="off"
            spellcheck="false" value="">
          <ul id="search-results"></ul>
        </div>
        <nav class="nav-links can-hide">
          <div class="nav-item"><a href="/" aria-current="page"
              class="nav-link router-link-exact-active router-link-active chgcolor">
              Guide
            </a></div>
          <div class="nav-item"><a href="https://linkedin.com/in/aaron-pescasio" target="_blank"
              rel="noopener noreferrer" class="nav-link external">
              LinkedIn
              <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px"
                  viewBox="0 0 100 100" width="15" height="15" class="icon outbound">
                  <path fill="currentColor"
                    d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z">
                  </path>
                  <polygon fill="currentColor"
                    points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9">
                  </polygon>
                </svg> <span class="sr-only">(opens new window)</span></span></a></div>
          <div class="nav-item"><a href="https://github.com/ApecioU/" target="_blank" rel="noopener noreferrer"
              class="nav-link external">
              GitHub
              <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px"
                  viewBox="0 0 100 100" width="15" height="15" class="icon outbound">
                  <path fill="currentColor"
                    d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z">
                  </path>
                  <polygon fill="currentColor"
                    points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9">
                  </polygon>
                </svg> <span class="sr-only">(opens new window)</span></span></a></div>
          <!---->
        </nav>
      </div>
    </header>
    <div class="sidebar-mask"></div>
    <aside class="sidebar">
      <nav class="nav-links">
        <div class="nav-item"><a href="/" aria-current="page"
            class="nav-link router-link-exact-active router-link-active">
            Guide
          </a></div>
        <div class="nav-item"><a href="https://linkedin.com/in/aaron-pescasio" target="_blank" rel="noopener noreferrer"
            class="nav-link external">
            LinkedIn
            <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px"
                viewBox="0 0 100 100" width="15" height="15" class="icon outbound">
                <path fill="currentColor"
                  d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z">
                </path>
                <polygon fill="currentColor"
                  points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9">
                </polygon>
              </svg> <span class="sr-only">(opens new window)</span></span></a></div>
        <div class="nav-item"><a href="https://github.com/apeciou" target="_blank" rel="noopener noreferrer"
            class="nav-link external">
            GitHub
            <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px"
                viewBox="0 0 100 100" width="15" height="15" class="icon outbound">
                <path fill="currentColor"
                  d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z">
                </path>
                <polygon fill="currentColor"
                  points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9">
                </polygon>
              </svg> <span class="sr-only">(opens new window)</span></span></a></div>
      </nav>
      <div class="carbon-ads"></div>
      <ul class="sidebar-links">
        <li>
          <div id="includedContent"></div>
         
        </li>
        <li>

        </li>

      </ul>
    </aside>
    <main class="page">
      <div class="theme-default-content content__default">
        <h1 id="what-is-fuse-js"><a href="#Aaron PESCASIO" class="header-anchor">#</a> Aaron PESCASIO</h1>
        <div><a href="https://twitter.com/apeciou" data-size="large" data-show-screen-name="false" data-dnt="true"
            data-show-count="false" class="twitter-follow-button">Follow</a>
          <script async="async" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
        </div>
        <p>Pour m'entrainer avec Linux, j'ai décidé de créer ce script qui préparera et sécurisera un VPS tout neuf (que je loue chez OVH). Grâce aux snapshots, j'ai été en mesure de tester l'exécution du script plusieurs fois et de revenir à chaque fois à un VPS tout neuf, ce qui m'a permis d'effectuer des tests en toute sécurité.</p>

        
          <a class="pagesconst" onclick="copyCode()">
            <h3>vps_prep.sh:</h3>
          </a>
          
  
        <div class="code-container">
          <pre> 
            #!/bin/bash

            # 1. Script pour préparer et sécuriser un VPS
            
            # Prérequis: -VPS sous Linux, -Connexion SSH, -Accès 'root'
            
            # Après avoir connecté sur le VPS avec ssh, je me connecte avec le compte 'root' : 'sudo su' 

            # Je mets à jour la liste des paquets 
            
            apt update
            
            # Je mets à jour des paquets à proprement parler
            
            apt upgrade -y
            
            # J'installe tous les paquets que j'aurai besoin pour sécuriser mon VPS et l'utiliser pour héberger mon site web
            
            apt install -y wget ufw fail2ban nginx # (fail2ban je laisse la config par défaut)

            # Je modifie le mot de passe de mon compte 'root'
            
            echo "Entrez un nouveau mot de passe pour le compte 'root'"
            
            passwd 
            
            # Je mets à jour le timezone de mon VPS
            
            timedatectl set-timezone Europe/Paris
            
            # Je mets à jour mon .bashrc (ce que j'ai ajouté: mes raccourcis, mes modifications concernant la commande history pour qu'ils affichent la date à coté de la commande executé)
            
            cd ~
            
            mv /etc/bash.bashrc /etc/bash.bashrc.backup
            
            wget -O /etc/bash.bashrc https://raw.githubusercontent.com/ApecioU/configfiles/main/bash.bashrc
            
            source /etc/bash.bashrc
            
            # Je modifie le port d'écoute SSH par défaut 
            
            while true; do
              read -p "Enter a number between 49152 and 65535: " port
              if [[ "$port" -ge 49152 && "$port" -le 65535 ]]; then # Pour plus de sécurité, utilisez un numéro entre 49152 et 65535.
                echo "Valid port: $port"
                break
              else
                echo "Invalid port. Please enter a number between 49152 and 65535."
              fi
            done
            
            sed -i "s/^#Port 22/Port $port/" /etc/ssh/sshd_config
            
            # N'oubliez pas que vous devrez indiquer le nouveau port à chaque demande de connexion SSH à votre serveur, par exemple :
            # ssh nomdutilisateur@IPv4_de_votre_VPS -p NouveauPort
            
            # Je désactive la connexion 'root' dans la config SSH 
            
            sed -i 's/^#PermitRootLogin prohibit-password/PermitRootLogin no/' /etc/ssh/sshd_config
            
            # Après 120s d'inactivité, déconnecte l'user
            
            sed -i 's/^#ClientAliveInterval 0/ClientAliveInterval 120/' /etc/ssh/sshd_config
            
            # Je définis une variable pour la création d'un compte perso
            
            read -p "Entrez un identifiant pour la création d'un compte perso : " perso
            
            # Je modifie la config ssh pour définir le nom d'utilisateurs qui peuvent utiliser ssh ; tous les autres utilisants sont bloqué
            
            echo "AllowUsers $perso" | sudo tee -a /etc/ssh/sshd_config
            
            # Je redémarre le service pour que cela s'applique 
            
            systemctl restart sshd
                                  
            # Avant d'activer le firewall ufw, j'autorise la connexion SSH sur le port que j'ai selectionné
            
            ufw allow $port/tcp && ufw allow 'Nginx Full'  # Cette commande permet la connexion SSH et HTTP+S sur les port selectionné et pour tous les autres ports : c'est bloqué :) 
            
            # Régler le 'Invalid argument' de NGINX à première installation 
            
            mkdir /etc/systemd/system/nginx.service.d
            printf "[Service]\nExecStartPost=/bin/sleep 0.1\n" > /etc/systemd/system/nginx.service.d/override.conf
            systemctl daemon-reload
            systemctl restart nginx 
            
            # Maintenant on peut activer le pare feu après avoir autorisé le nouveau port SSH 
            
            ufw enable
            
            # Je crée un compte perso et je l'ajoute dans le groupe 'sudo' 
            
            sudo useradd -m -s /bin/bash -G sudo $perso && echo "Entrez un mot de passe pour $perso" && passwd $perso && sudo usermod -c "$perso" $perso
            
            # Je me connecte avec mon compte perso
            
            su $perso
            
            
          </pre>

          <button class="copy-button">Copy</button>
        </div>


        <!-- <h3 id="why-should-i-use-it"> Vidéo d'exécution du script:
        </h3> -->

        <br>
        <div class="page-navigation">
          <a href="https://apescasio.fr/memo/ws/migration" class="prevpage"><strong><< WS-Migration</strong></a>
          <a href="https://apescasio.fr/memo/vps/web" class="nextpage"><strong>VPS Web >></strong></a>
        </div>



      </div>
    </main>
    <script>
      function copyCode() {
        var code = document.querySelector('.code-container pre').textContent;
        navigator.clipboard.writeText(code);
      }
// Get all <pre> blocks
  const codeBlocks = document.querySelectorAll('pre');

  // Loop through each <pre> element
  for (let i = 0; i < codeBlocks.length; i++) {
    const lines = codeBlocks[i].textContent.trim().split('\n');
    let code = '';
  
    // Wrap each line in <code> tags and apply appropriate class
    for (let j = 0; j < lines.length; j++) {
      let line = lines[j].trim();
      let className = '';
  
      // Determine appropriate class based on contents of the line
      if (line.startsWith('#')) {
        className = 'powershell-comment';
      } else {
        // Split line into individual tokens based on whitespace
        const tokens = line.split(/\s+/);
        for (let k = 0; k < tokens.length; k++) {
          const token = tokens[k];
          if (token.startsWith('$')) {
            // Token is a PowerShell variable
            const variableName = token.replace('$', '');
            // Replace the variable name in the line with a span element with the appropriate class
            line = line.replace(token, `<span class="powershell-variable">${token}</span>`);
          } else if (!className) {
            // Token is a PowerShell command (if no class has been assigned yet)
            className = 'powershell-command';
          }
        }
      }
  
      // Wrap line in <code> tags and apply class
      code += '<code';
      if (className) {
        code += ' class="' + className + '"';
      }
      code += '>' + line + '</code>\n';
    }
  
    // Replace the original <pre> content with the wrapped code
    codeBlocks[i].innerHTML = code;
  }
  
  
    </script>
    <script src="/memo/memo_files/script.js"></script>
    <script src="/memo/memo_files/nav.js"></script>
        <script src="/pff/include.js"></script>
   <script>
      $(function() {
        $("#includedContent").load("/memo/memo_files/headermemo.txt");
      });
    </script>
</body>

</html>