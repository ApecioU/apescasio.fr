<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Aaron PESCASIO - Mémoire</title>
  <meta name="generator" content="VuePress 1.8.3">
  <link rel="apple-touch-icon" size="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" size="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" size="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" size="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" size="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" size="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" size="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" size="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" size="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" size="192x192" href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" size="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" size="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" size="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <link rel="stylesheet" href="/memo/memo_files/style.css">
  <link rel="stylesheet" href="/memo/memo_files/lang.css">
  <link rel="shortcut icon" href="/memo/memo_files/logo.png" type="image/x-icon">
  <meta name="description" content="Aaron PESCASIO - Mémoire">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="google-site-verification" content="4nm40QLVcDJmEJSAbrMfZ7fpBJZIXL1oSngBAYrZopY">

  <link rel="preload" href="/memo/memo_files/style.css" as="style">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<meta name="description" content="Aaron Pescasio - Mémoire">
<meta property="og:title" content="Aaron Pescasio">
<meta property="og:description" content="Mémoire Administrateur">
<meta property="og:image" content="https://www.apescasio.fr/memo/memo_files/logo.png">
<meta property="og:url" content="https://www.apescasio.fr/memo">
</head> 

<style>
  :root {
    --darkreader-neutral-background: #0e1011;
    --darkreader-neutral-text: #dcd8d3;
    --darkreader-selection-background: #004aac;
    --darkreader-selection-text: #edebe8;
  }

  a.sidebar-link {
    color: rgb(176, 197, 215);
  }


  * {
    scrollbar-color: #42474a #1b1e1f;
  }

  .navbar {
    background-color: rgb(19, 21, 22);
    border-bottom-color: rgb(49, 55, 57);
  }

  .sidebar {
    background-color: rgb(19, 21, 22);
    border-right-color: rgb(49, 55, 57);
  }

  .search-box input {
    color: rgb(137, 168, 193);
    border-color: rgb(57, 62, 64);
    outline-color: currentcolor;
    background-color: rgb(19, 21, 22);
    background-image: url("https://www.apescasio.fr/memo/memo_files/search-icon.svg");
  }


  .navbar .site-name {
    color: rgb(176, 197, 215);
  }

  pre {
    background-color: rgb(18, 19, 20);
    color: rgb(209, 204, 197);
    border-color: rgb(110, 102, 89);
  }

  a,
  p a code {
    color: #9066b8;
  }

  *,
  *:before,
  *:after {
    box-sizing: border-box;
  }

  body {
    color: rgb(176, 197, 215);
  }

  .search-result-text-color {
    background-color: #44484a;
    color: rgb(176, 197, 215);
  }

  @media screen and (max-width: 719px) {
    .logo {
      margin-top: -10px;
    }

    .page-navigation {
      flex-wrap: wrap;
    }

    .page-navigation {
      flex-wrap: wrap;
    }

    .prevpage,
    .nextpage {
      flex: 1;
      text-align: center;
      margin: 0;
    }

    .prevpage {
      order: 1;
    }

    .nextpage {
      order: 2;
    }
  }
</style>


<body>



  <!--navbar-->
  <div class="theme-container">
    <header class="navbar">
      <div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img"
          viewBox="0 0 448 512" class="icon">
          <path fill="currentColor"
            d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z">
          </path>
        </svg></div> <a href="https://apescasio.fr/" aria-current="page"
        class="home-link router-link-exact-active router-link-active"><img src="/memo/memo_files/logo.png" alt="AP"
          class="logo"></a> <a href="https://apescasio.fr/memo"><span class="site-name can-hide">Mémoire</span></a>
      <div class="links">
        <div class="search-box"><input type="text" id="search-input" aria-label="Search" autocomplete="off"
            spellcheck="false" value="">
          <ul id="search-results"></ul>
        </div>
        <nav class="nav-links can-hide">
          <div class="nav-item"><a href="/" aria-current="page"
              class="nav-link router-link-exact-active router-link-active chgcolor">
              Guide
            </a></div>
          <div class="nav-item"><a href="https://linkedin.com/in/aaron-pescasio" target="_blank"
              rel="noopener noreferrer" class="nav-link external">
              LinkedIn
              <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px"
                  viewBox="0 0 100 100" width="15" height="15" class="icon outbound">
                  <path fill="currentColor"
                    d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z">
                  </path>
                  <polygon fill="currentColor"
                    points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9">
                  </polygon>
                </svg> <span class="sr-only">(opens new window)</span></span></a></div>
          <div class="nav-item"><a href="https://github.com/ApecioU/" target="_blank" rel="noopener noreferrer"
              class="nav-link external">
              GitHub
              <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px"
                  viewBox="0 0 100 100" width="15" height="15" class="icon outbound">
                  <path fill="currentColor"
                    d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z">
                  </path>
                  <polygon fill="currentColor"
                    points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9">
                  </polygon>
                </svg> <span class="sr-only">(opens new window)</span></span></a></div>
          <!---->
        </nav>
      </div>
    </header>
    <div class="sidebar-mask"></div>
    <aside class="sidebar">
      <nav class="nav-links">
        <div class="nav-item"><a href="/" aria-current="page"
            class="nav-link router-link-exact-active router-link-active">
            Guide
          </a></div>
        <div class="nav-item"><a href="https://linkedin.com/in/aaron-pescasio" target="_blank" rel="noopener noreferrer"
            class="nav-link external">
            LinkedIn
            <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px"
                viewBox="0 0 100 100" width="15" height="15" class="icon outbound">
                <path fill="currentColor"
                  d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z">
                </path>
                <polygon fill="currentColor"
                  points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9">
                </polygon>
              </svg> <span class="sr-only">(opens new window)</span></span></a></div>
        <div class="nav-item"><a href="https://github.com/apeciou" target="_blank" rel="noopener noreferrer"
            class="nav-link external">
            GitHub
            <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px"
                viewBox="0 0 100 100" width="15" height="15" class="icon outbound">
                <path fill="currentColor"
                  d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z">
                </path>
                <polygon fill="currentColor"
                  points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9">
                </polygon>
              </svg> <span class="sr-only">(opens new window)</span></span></a></div>
      </nav>
      <div class="carbon-ads"></div>
      <ul class="sidebar-links">
        <li>
          <div id="includedContent"></div>
         
        </li>
        <li>

        </li>

      </ul>
    </aside>
    <main class="page">
      <div class="theme-default-content content__default">
        <h1 id="what-is-fuse-js"><a href="#Aaron PESCASIO" class="header-anchor">#</a> Aaron PESCASIO</h1>
        <div><a href="https://twitter.com/apeciou" data-size="large" data-show-screen-name="false" data-dnt="true"
            data-show-count="false" class="twitter-follow-button">Follow</a>
          <script async="async" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
        </div>
        <h3>Synchronisation des utilisateurs Office 365 avec l'AD on-premise:</h3>

      
        <p>Azure AD Connect joue le rôle de passerelle entre votre Active Directory et votre locataire Office 365
          #EntraID. Si vous n'avez pas encore d'utilisateurs sur Office 365, la configuration prendra seulement 5
          minutes maximum. </p> 
          <p>Cependant, un problème survient si vous avez déjà créé vos utilisateurs sur Office 365 et que
          vous souhaitez les synchroniser avec l'AD. C'est à ce moment qu'il faut trouver une solution.</p>
        <p>La solution consiste tout d'abord à supprimer les doublons d'utilisateurs et à conserver les originaux. Dans
          ce cas, l'utilisateur original est "apes", donc l'autre doit être supprimé.</p>
          <img src="/memo/memo_files/adc/34.PNG">
          <img src="/memo/memo_files/adc/35.PNG">

        <p>Enfin, exécutez le script "FixADConnect.ps1". Dans la première fenêtre, sélectionnez l'utilisateur de l'AD
          local "apes".</p>         <img src="/memo/memo_files/adc/36.PNG">
          <p>Puis dans la deuxième fenêtre, choisissez l'utilisateur de l'Azure AD avec lequel vous souhaitez
          le synchroniser.  </p>           <img src="/memo/memo_files/adc/37.PNG">

           <p>Après la synchronisation, le script vous demandera si vous souhaitez continuer à synchroniser
          d'autres utilisateurs ou non. </p> 

          <img src="/memo/memo_files/adc/38.PNG">
          
         <p>Si vous entrez "N", une fenêtre affichera simplement les utilisateurs avec leurs
          "ImmutableId".</p> 
        
          <img src="/memo/memo_files/adc/40.PNG">
          <p>Comme vous pouvez le constater dans l'Azure AD, l'utilisateur "apes" est maintenant synchronisé. "Yes" !</p>

          <img src="/memo/memo_files/adc/39.PNG">

        <a class="pagesconst" onclick="copyCode()">
          <h3>FixAdConnect.ps1:</h3>
        </a>

        <div class="code-container">
          <pre>
            # Script pour synchroniser les utilisateurs Office 365 déjà existants 
            # sur l'Azure AD avec l'AD on-premise (local)

            $credential = Get-Credential
Import-Module MsOnline
Connect-MsolService -Credential $credential
Set-MsolDirSyncEnabled -EnableDirSync $false
$IsDirSyncEnabled = (Get-MsolCompanyInformation).DirectorySynchronizationEnabled
If($IsDirSyncEnabled -eq $false) {Write-Host Office 365 Active Directory Sync Disabled - Good to go!}
else {Write-Host Please disable Active Directory Sync and Wait Exit}
Start-Sleep -Seconds 5
do{
$ADGuidUser = Get-ADUser -Filter * | Select Name,ObjectGUID | Sort-Object Name | Out-GridView -Title "Select Local AD User To Get Immutable ID for" -PassThru
$UserimmutableID = [System.Convert]::ToBase64String($ADGuidUser.ObjectGUID.tobytearray())
$OnlineUser = Get-MsolUser | Select UserPrincipalName,DisplayName,ProxyAddresses,ImmutableID | Sort-Object DisplayName | Out-GridView -Title "Select The Office 365 Online User To HardLink The AD User To" -PassThru
Set-MSOLuser -UserPrincipalName $OnlineUser.UserPrincipalName -ImmutableID $UserimmutableID
$Repeat = read-host Do you want to choose another user? Y or N } while ($Repeat -eq "Y")
Get-MsolUser | Select DisplayName,ImmutableID | Sort-Object DisplayName | Out-GridView -Title "Office 365 User List With Immutableid Showing"
Set-MsolDirSyncEnabled -EnableDirSync $true
Start-ADSyncSyncCycle -PolicyType Delta
Start-Sleep -Seconds 5
Get-PSSession | Remove-PSSession

# Si jamais vous recevez un mail concernant l'Azure AD "Password Hash Synchronization heartbeat was skipped in last 120 minutes.", veuillez lancer cette commande :
# Restart-Service -Name "ADSync" 3> $null 
# Sinon, vous pouvez aussi redémarrer le service "Microsoft Azure AD Sync" en passant par la fenêtre "services.msc".

          </pre>

          <button class="copy-button">Copy</button>
        </div>



        <div class="page-navigation">
          <a href="https://apescasio.fr/memo/azure" class="prevpage"><strong>
              << Install Azure AD</strong></a>
          <a href="https://www.apescasio.fr/memo/vt/ad/" class="nextpage"><strong>Virtualisation >></strong></a>
        </div>



      </div>
    </main>
    <script>
      function copyCode() {
        var code = document.querySelector('.code-container pre').textContent;
        navigator.clipboard.writeText(code);
      }
    </script>
    <script src="/memo/memo_files/precode.js"></script>
    <script src="/memo/memo_files/script.js"></script>
    <script src="/memo/memo_files/nav.js"></script>
    <script src="/pff/include.js"></script>
   <script>
      $(function() {
        $("#includedContent").load("/memo/memo_files/headermemo.txt");
      });
    </script>
</body>

</html>